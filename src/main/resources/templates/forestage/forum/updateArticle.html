<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<meta name="description" content="" />
	<meta name="author" content="" />
	<title>è«–å£‡æ›´æ–°æ–‡ç« </title>
	<!-- Favicon-->
	<link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
	<!-- Bootstrap icons-->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
	<!-- Google font -->
	<link href="https://fonts.googleapis.com/css2?family=Ysabeau+SC&display=swap" rel="stylesheet">
	<!-- Core theme CSS (includes Bootstrap)-->
	<link th:href="@{/forestage/forum/mainPage/css/styles.css}" rel="stylesheet" />
	<style>
		.ck-editor__editable {
			min-height: 400px;
		}

		#drawArea div {
			display: flex;
			justify-content: space-around;
			align-items: center;
		}
	</style>

</head>

<body class="d-flex flex-column h-100">
	<main class="flex-shrink-0">
		<div th:replace="~{forestage/shared/foreTopNav}"></div>
		<div class="container mt-5">
			<div class="row justify-content-center">
				<div class="col-lg-8">
					<h2 class="text-center" style="font-weight:bold;">æ›´æ–°æ–‡ç« </h2>
					<form th:action="@{/forum/article/update/{articleId}(articleId=${article.articleId})}"
						id="updateForm" method="POST" enctype="multipart/form-data">
						<div class="mb-3">
							<label for="articleTitle" class="form-label"
								style="background-color: rgba(251, 195, 188,0.5); font-size: 18px;">æ–‡ç« æ¨™é¡Œ</label>
							<input type="text" class="form-control" id="articleTitle" name="articleTitle"
								th:value="${article.articleTitle}" placeholder="è¼¸å…¥æ–‡ç« æ¨™é¡Œ">
						</div>
						<div class="mb-3">
							<label for="articleContent" class="form-label"
								style="background-color: rgba(251, 195, 188,0.5); font-size: 18px;">æ–‡ç« å…§å®¹</label>
							<textarea class="form-control" id="articleContent" name="articleContent"
								style="background-color: rgba(251, 195, 188,0.5); font-size: 18px;">
			[[${article.articleContent}]]
		</textarea>
						</div>
						<div class="mb-3">
							<label for="hashtag" class="form-label"
								style="background-color: rgba(251, 195, 188,0.5);font-size: 18px;">Hashtagã€€æé†’ï¼šä»¥åŠå½¢ç©ºæ ¼ç‚ºåˆ†éš”ï¼Œä¾‹å¦‚"æ”å½±
								åˆ†äº« å ´åœ°"å¦‚æ­¤è¼¸å…¥å³å¯</label>
							<input type="text" class="form-control" id="hashtag" name="hashtag"
								th:value="${article.hashtag}" placeholder="è¼¸å…¥æ–‡ç« çš„Hashtag">
						</div>
						<div class="mb-3">
							<label for="articlePic" class="form-label"
								style="background-color: rgba(251, 195, 188,0.5); font-size: 18px;">ä¸Šå‚³åœ–ç‰‡</label>
							<input class="form-control" type="file" id="articlePic" name="articlePic"
								onchange="previewFile()" multiple>
							<div id="previewImage">
								<a href="#!" class="d-block mx-auto">
									<img th:src="@{/forum/article/{articleId}/image(articleId=${article.articleId})}"
										alt="..." class="card-img1"
										style="object-fit: contain; width: 200px; height: 200px;" />
								</a>
							</div>
						</div>

						<div class="row justify-content-center">
							<button type="submit" class="btn btn-primary m-2"
								style="font-size: 20px; width: 80px; padding: 10px 10px;">æäº¤</button>
						</div>

					</form>

				</div>
				<div class="col-lg-4">
					<div class="card mb-4">
						<div class="card-header">
							<h2 class="text-center">æˆ‘çš„å°ç•«å¸ƒ</h2>
						</div>
						<div class="card-body" style="height: 500px;">
							<select id="colorSelector" class="form-select mb-2" style="width: 200px;">
								<option value="black">é»‘è‰²</option>
								<option value="blue">è—è‰²</option>
								<option value="red">ç´…è‰²</option>
								<option value="green">ç¶ è‰²</option>
								<option value="yellow">é»ƒè‰²</option>
								<option value="orange">æ©˜è‰²</option>
								<option value="purple">ç´«è‰²</option>
								<option value="pink">ç²‰ç´…è‰²</option>
								<option value="brown">æ£•è‰²</option>
								<option value="gray">ç°è‰²</option>
							</select>
							<div id="drawArea"
								style="height: 350px; width: 350px; border: 1px solid #FFB5A7; margin: auto;">
								<canvas id="game-canvas" width="350" height="350"></canvas>
								<div style="display: flex; justify-content: space-around; align-items: center;">
									<img id="insertCanvasContentButton" class="btn-sm"
										th:src="@{/forestage/forum/insertArticle/assets/insert.png}"
										style="cursor: pointer;">
									<img id="downloadButton" class="mx-auto"
										th:src="@{/forestage/forum/insertArticle/assets/download.png}"
										style="cursor: pointer;">
									<img id="clearCanvas" class="mt-10 mx-auto"
										th:src="@{/forestage/forum/insertArticle/assets/clean.png}"
										style="cursor: pointer;">


								</div>
							</div>

						</div>
					</div>
				</div>




				<script src="https://cdn.ckeditor.com/4.14.0/standard/ckeditor.js"></script>
				<script>
					// åˆå§‹åŒ– CKEditor 4
					var articleContentElement = document.getElementById('articleContent');
					var articleContentEditor = CKEDITOR.replace('articleContent');

					// åªæœ‰ç•¶æ–‡ç« å…§å®¹ç‚ºç©ºæ™‚ï¼Œæ‰è¨­å®šé»˜èªå…§å®¹
					if (!articleContentElement.value) {
						articleContentEditor.setData('<p>Hello WorldğŸ˜„</p>');
					}

					document.getElementById('updateForm').addEventListener('submit', function () {
						var editorContent = articleContentEditor.getData();
						document.getElementById('articleContent').value = editorContent;
					});

					document.querySelector("#insertCanvasContentButton").addEventListener("click", function () {
						console.log('insertCanvasContentButton è¢«é»æ“Šäº†');  // åœ¨ click äº‹ä»¶è§¸ç™¼æ™‚è¼¸å‡ºæ—¥èªŒ

						// ç²å–ç•«å¸ƒå…§å®¹
						var canvas = document.querySelector("#game-canvas");
						var image2 = canvas.toDataURL('image/png');

						console.log('åœ–ç‰‡å·²ç”Ÿæˆï¼ŒURL ç‚ºï¼š', image2);  // åœ¨åœ–ç‰‡ç”Ÿæˆå¾Œè¼¸å‡ºæ—¥èªŒ

						// æ’å…¥ç•«å¸ƒå…§å®¹åˆ°æ–‡ç« å…§å®¹ä¸­
						var html = '<img src="' + image2 + '" style="max-width:200px; max-height:200px;" alt="Canvas Image"/>';
						articleContentEditor.insertHtml(html);
					});
				</script>



				<!-- Include CKEditor JS
			<script src="https://cdn.ckeditor.com/4.16.0/standard/ckeditor.js"></script> -->

				<!-- Initialize CKEditor
			<script>
				CKEDITOR.replace('articleContent');
			</script> -->

				<!-- Preview uploaded image -->
				<script>
					function previewFile() {
						var files = document.querySelector('#articlePic').files;
						var preview = document.querySelector('#previewImage');
						preview.innerHTML = ""; // æ¸…ç©ºé è¦½

						Array.from(files).forEach(file => {
							var reader = new FileReader();

							reader.onloadend = function () {
								var img = document.createElement('img'); // å‰µå»ºæ–°çš„ img å…ƒç´ 
								img.src = reader.result; // å°‡è®€å–åˆ°çš„çµæœè³¦å€¼çµ¦ img
								img.style.width = '300px'; // è¨­å®šå¯¬åº¦
								preview.appendChild(img); // æ·»åŠ åˆ°é è¦½å€åŸŸ
							}

							if (file) {
								reader.readAsDataURL(file);
							}
						});
					}
				</script>

				<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>

				<script>
					document.querySelector('form').addEventListener('submit', function (e) {
						var hashTagInput = document.querySelector('input[name="hashtag"]');
						var hashTags = hashTagInput.value.split(' ');

						if (hashTags.length > 5) {
							e.preventDefault();
							swal("è«‹æ³¨æ„", "Hashtag æ¨™ç±¤ä¸Šé™ç‚º 5 å€‹ï¼Œæ‚¨å·²è¶…é", "error");
						}
					});
				</script>



				<script>
					document.getElementById('downloadButton').addEventListener('click', function () {
						var canvas = document.getElementById('game-canvas');
					})


				</script>
				<!-- Game script -->
				<script th:src="@{/forestage/forum/mainPage/js/game.js}"></script>
				<!-- çµå°¾éƒ¨åˆ† -->
</body>

</html>